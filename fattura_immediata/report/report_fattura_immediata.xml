<?xml version="1.0" encoding="utf-8" ?>
<!--
    Copyright (c) 2022, ABC Srl
    @author: Massimo Masi <m.masi@abcstrategie.it>
  -->
<odoo>
    
    <template id="fattura_immediata_report_template">
        <t t-call="web.basic_layout">
            <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)" />
            <style type="text/css">
       
                    .small-font {
                                    font-size:80%;
                                }
                    .smaller-font {
                                    font-size:50%;
                                }
                    .bold-font {
                                    font-weight:bold
                                    }
                    .rounded-tl {
                                    border-top-left-radius: 5px
                                }
                    .rounded-tr {
                                    border-top-right-radius: 5px
                                }
                    .rounded-bl {
                                    border-bottom-left-radius: 5px;
                                }
                    .rounded-br {
                                    border-bottom-right-radius: 5px
                    
                    .full-width {   
                                    width:100%
                                    margin-left:auto;
                                    margin-right:auto;
                                }
                
            </style>
            <div t-attf-class="header o_company_#{o.company_id.id}_layout" t-att-style="report_header_style">
                <!-- INTESTAZIONE -->
                <!--div class="row">
                    <div class="col-6">
                        <img class="img-fluid" t-att-src="image_data_uri(o.company_id.logo)" style="max-width:350px"/>
                    </div>
                    <div class="col-6">
                    </div>
                </div-->
                <div class="row address mb-3 small-font">
                    <div class="col-6">
                        <div><img class="img-fluid" t-att-src="image_data_uri(o.company_id.logo)" style="max-width:350px"/></div>
                        <div style="font-weight: bold; font-size:80%;" t-field="o.company_id.partner_id"/>
                        <div>
                            <span t-field="o.company_id.street" style="font-size:80%;"/>
                            <span t-field="o.company_id.zip" style="font-size:80%;"/>
                            <span t-field="o.company_id.state_id" style="font-size:80%;"/>
                        </div>
                        <ul class="list-inline">
                            <li class="list-inline-item d-inline" t-if="o.company_id.phone" style="font-size:60%;">Tel: <span class="o_force_ltr" t-field="o.company_id.phone"/></li>
                            <li class="list-inline-item d-inline" t-if="o.company_id.partner_id.mobile" style="font-size:60%;">Cell: <span t-field="o.company_id.partner_id.mobile"/></li>
                            <li class="list-inline-item d-inline" t-if="o.company_id.partner_id.fax" style="font-size:60%;">Fax: <span t-field="o.company_id.partner_id.fax"/></li>
                            <li class="list-inline-item d-inline" t-if="o.company_id.email" style="font-size:60%;">Email: <span t-field="o.company_id.email"/></li>
                        </ul>
                        <ul class="list-inline mb4" style="margin-top:-15px">
                            <li class="list-inline-item d-inline" t-if="o.company_id.website" style="font-size:60%;">Site: <span t-field="o.company_id.website" /></li>
                            <li class="list-inline-item d-inline" t-if="o.company_id.vat" style="font-size:60%;"><strong>Partita IVA: </strong><span t-field="o.company_id.vat"/></li>
                            <li class="list-inline-item d-inline" style="font-size:60%;"><strong>REA: </strong><span>176824-TP</span></li>
                        </ul>
                        <ul class="list-inline mb4" style="margin-top:-15px">
                            <li class="list-inline-item d-inline" t-if="o.company_id.partner_id.pec_mail" style="font-size:60%;">PEC: <u><span t-field="o.company_id.partner_id.pec_mail"/></u></li>
                            
                        </ul>
                    </div>
                    <div class="col-6">
                        <div style="height:20px;"/>
                        <div style="border-bottom: 1px solid black; border-left: 1px solid black; padding-left:5px; padding-bottom:5px; line-height:100%">
                            <span style="margin-bottom:0px; font-size:70%;">SPETT.LE</span>
                            <div>
                                <span t-field="o.partner_id" style=" font-weight:bold;font-size:70%;"/>
                            </div>
                            <span t-field="o.partner_id.street" style=" font-weight:bold;font-size:70%;"/>
                            <div style=" font-weight:bold;font-size:70%;">
                                <span t-field="o.partner_id.zip"/>
                                <span t-field="o.partner_id.city"/>
                                <span t-field="o.partner_id.state_id"/> 
                            </div>
                        </div>
                    
                        <div style="margin-top:10px;  border-bottom: 1px solid black; border-left: 1px solid black; padding-left:5px; padding-bottom:5px; padding-top:1px; line-height:100%">
                            <strong t-if="o.partner_shipping_id == o.partner_id" style="font-size:70%;">Indirizzo di Fatturazione e Spedizione:</strong>
                            <strong t-if="o.partner_shipping_id != o.partner_id" style="font-size:70%;">Indirizzo di Fatturazione:</strong>
                            <div style="font-size:70%;" t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True}"/>
                            <t t-if="o.partner_shipping_id != o.partner_id">
                                <strong style="font-size:70%;">Indirizzo di Spedizione:</strong>
                                <div style="font-size:70%;" t-field="o.partner_shipping_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;,&quot;address&quot;], &quot;no_marker&quot;: True}"/>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
                
                
            <!-- PAGE -->
    
            <div class="page">
                
                <!-- PRIMA TABELLA -->

                <table class="table table-bordered mt-1">
                    <thead>
                        <tr scope="row">
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <strong>COD.CLI. Arca</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <strong>COD.CLI. Odoo</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <strong>PARTITA IVA</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <strong>CODICE FISCALE</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.5%">
                                <strong>TELEFONO</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <strong>N° DOCUMENTO</strong>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <strong>DATA DOC.</strong>
                            </th>
                        </tr>  
                    </thead>
                    <tbody>
                        <tr scope="row">
                            <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span t-field="o.partner_id.codice_arca"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span t-field="o.partner_id.id"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-field="o.partner_id.vat"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-field="o.partner_id.fiscalcode"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.5%">
                                <span t-field="o.partner_id.phone"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Fattura</span>
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Bozza Fattura</span>
                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Fattura Annullata</span>
                                    <span t-if="o.move_type == 'out_refund'">Nota di Credito</span>
                                    <span t-if="o.move_type == 'in_refund'">Nota di Credito Fornitore</span>
                                    <span t-if="o.move_type == 'in_invoice'">Fattura di Acquisto</span>
                                    <span t-if="o.name != '/'" t-field="o.name"/>
                                </t>
                                <t style="font-weight:bold;" t-if="env.context.get('proforma', False) or is_pro_forma">
                                    <span>Fattura Pro-forma</span>
                                </t>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-field="o.invoice_date"/>
                            </td>
                        </tr>
                    </tbody>
                    <thead>
                        <tr scope="row">
                            <th scope="col" colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <span>COD. LISTA</span>
                            </th>
                            <th scope="col" colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <span>CONDIZIONI DI PAGAMENTO</span>
                            </th>
                            <th scope="col" colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <span>RESP. VENDITA</span>
                            </th>
                            <th scope="col" colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <span>BANCA D'APPOGGIO</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr scope="row">
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <t t-if="o.cod_lista"><span t-field="o.cod_lista"/></t>

                            </td>
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <t t-if="o.invoice_payment_term_id"><t t-esc="o.invoice_payment_term_id.name"/></t><t t-else=""><t t-esc="o.invoice_date_due" options='{"widget": "date"}'/></t>
                            </td>
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <span t-field="o.user_id"/>
                            </td>
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:25%">
                                <t t-if="o.partner_id.bank_ids.bank_name"><span t-field="o.partner_id.bank_ids.bank_name"/>  </t><t t-if="o.partner_id.bank_ids.acc_number"><span t-field="o.partner_id.bank_ids.acc_number"/></t>
                            </td>
                        </tr>
                    </tbody>
                </table>



                <!-- RIGHE PRODOTTI -->


                <table class="table table-bordered mt-1">
                    <thead>
                        <tr scope="row">
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>COD. ART.</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-4" style="width:51.65%">
                                <span>DESCRIZIONE</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                <span>UM</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                <span>QUANTITÀ</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                <span>PREZZO UNIT.</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:6%">
                                <span>SC. %</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>PREZZO TOT.</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                <span>C.IVA</span>
                            </th>
                        </tr> 
                    </thead>
                    <tbody>
                        <t t-set="current_subtotal" t-value="0"/>
                        <t t-set="current_line" t-value="0"/>
                        <t t-set="totale_merce" t-value="0"/>
                        <t t-set="totale_netto" t-value="0"/>
                        <t t-set="totale_sconto" t-value="0"/>
                        <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                        <t t-foreach="lines" t-as="line">

                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                            <t t-if="not line.display_type">
                                <t t-set="current_line" t-value="current_line + 1"/>
                                <tr scope="row">

                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                        <span t-field="line.product_id.id"/>
                                    </td>


                                    <td class="p-1 align-middle text-center smaller-font col-4" style="width:51.65%">
                                        <span t-field="line.name"/>
                                    </td>

                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                        <span t-field="line.product_uom_id"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                        <span t-field="line.quantity"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                        <span t-field="line.price_unit"/>
                                        <t t-set="totale_merce" t-value="totale_merce + (line.price_unit*line.quantity)"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:6%">
                                        <span t-field="line.discount"/>
                                       <t t-set="totale_sconto" t-value="totale_sconto + (line.price_unit*line.quantity*line.discount/100)"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                        <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <t t-set="totale_netto" t-value="totale_netto + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        <t t-set="totale_netto" t-value="totale_netto + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                        <t t-foreach="line.tax_ids" t-as="tax_line">
                                            <span t-field="tax_line.codice_iva"/>
                                        </t>
                                    </td>
                                </tr>   
                            </t>
                            <t t-else="">
                                <tr scope="row">
                                    <td colspan="10" class="p-1 align-middle text-left smaller-font col-12">
                                        <strong t-field="line.name"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody> 
                </table>


               <!-- TABELLA LOTTI-->

               <t t-set="lot_values" t-value="o._get_invoiced_lot_values()"/>
               <t t-if="lot_values"> 
                   <table groups="sale_stock.group_lot_on_invoice" class="table table-sm" name="invoice_snln_table">
                        <thead>
                            <tr>
                                <th colspan="4" class="smaller-font"><span>LOTTI</span></th>
                            </tr>
                            <tr>
                                <th class="smaller-font"><span>PRODOTTO</span></th>
                                <th class="text-right smaller-font"><span>QUANTITÀ</span></th>
                                <th class="text-right smaller-font"><span>LOTTO</span></th>
                                <th class="text-right smaller-font"><span>SCADENZA</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="lot_values" t-as="snln_line">
                                <tr>
                                    <td class="smaller-font"><t t-esc="snln_line['product_name']"/></td>
                                    <td class="text-right smaller-font">
                                        <t t-esc="snln_line['quantity']"/>
                                        <t t-esc="snln_line['uom_name']" groups="uom.group_uom"/>
                                    </td>
                                    <td class="text-right smaller-font"><t t-esc="snln_line['lot_name']"/></td>
                                    <t t-if="lot_id in snln_line">
                                    <t t-set="lot_id" t-value="snln_line['lot_id']"/>
                                    <t t-set="lot" t-value="env['stock.production.lot'].browse([lot_id])"/>
                                    
                                    <td class="text-right smaller-font"><span t-field="lot.expiration_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/></td>
                                    </t>
                                    <t t-else="">
                                        <!-- SE NON E PRESENTE L ID DEL LOTTO LO CERCA PER NOME -->
                                        <t t-set="lot_name" t-value="snln_line['lot_name']"/>
                                        <t t-set="lot_by_name" t-value="env['stock.production.lot'].name_search(lot_name)"/>
                                        <t t-set="first_lot_id" t-value="lot_by_name[0][0]"/>
                                        <t t-set="first_lot" t-value="env['stock.production.lot'].browse([first_lot_id])"/>
                                        <td class="text-right smaller-font">
                                            <span t-esc="first_lot.expiration_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                                        </td>
                                        
                                    </t>
                                </tr>
                            </t>
                        </tbody>
                   </table>
               </t>





               

                <!-- TABELLA FINALE -->


                <table class="table table-bordered mt-1" style="page-break-inside: avoid;">
                    <thead>
                        <tr scope="row">
                            <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span>TOTALE MERCE</span>
                            </th>
                            <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>SC. % MERCE</span>
                            </th>
                            <th class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span>IMPORTO SCONTO</span>
                            </th>
                            <t t-if="o.amount_sp>0">
                                <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>TOTALE NETTO</span>
                                </th>
                            </t>
                            <t t-else="">
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>TOTALE NETTO</span>
                                </th>
                            </t>
                            <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>SPESE ART. 15</span>
                            </th>
                            <th class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span>TOTALE IMPONIBILE</span>
                            </th>
                            <t t-if="o.amount_sp>0">
                                <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>TOTALE IVA</span>
                                </th>
                                <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>SPLIT PAYM.</span>
                                </th>
                            </t>
                            <t t-else="">
                                <th class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>TOTALE IVA</span>
                                </th>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr scope="row">
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-esc="totale_merce" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span t-esc="100*totale_sconto/totale_merce" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-esc="totale_sconto" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </td>
                            <t t-if="o.amount_sp>0">
                                <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-esc="totale_netto" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>
                            </t>
                            <t t-else="">
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span t-esc="totale_netto" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>
                            </t>
                            <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <t t-value="0" t-set="spese_art_15"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.codice_iva == 'E15'">
                                        <t t-value="spese_art_15 + line.price_subtotal" t-set="spese_art_15"/>
                                    </t>
                                </t>
                                <t t-esc="spese_art_15" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                <span t-field="o.amount_untaxed"/>
                            </td>
                            <t t-if="o.amount_sp>0">
                                <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.amount_tax"/>
                                </td>
                                <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.amount_sp" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>
                            </t>
                            <t t-else="">
                                <td class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span t-field="o.amount_tax"/>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                    <thead>
                        <tr scope="row">
                            <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>CODICI IVA</span>
                            </th>
                            <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>IMPONIBILE</span>
                            </th>
                            <th class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>IMPOSTA</span>
                            </th>
                            <th  class="p-1 align-middle text-center smaller-font col-6" style="width:16.66%">
                                <strong>TOTALE FATTURA</strong>
                            </th>
                            <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:25%">
                                <span>SCADENZE</span>
                            </th>
                            <t t-if="o.amount_sp>0">
                                <th colspan="4" class="p-1 align-middle text-center smaller-font col-3" style="width:33.32%">
                                    <strong>PER QUIETANZA</strong>
                                </th>
                            </t>
                            <t t-else="">
                                <th colspan="3" class="p-1 align-middle text-center smaller-font col-3" style="width:33.32%">
                                    <strong>PER QUIETANZA</strong>
                                </th>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr scope="row">
                            <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <t t-value="[]" t-set="codiciIva"/>
                                <t t-value="[]" t-set="aliquoteIva"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.codice_iva and (line.tax_ids.codice_iva not in codiciIva)">
                                        <t t-value="codiciIva.append(line.tax_ids.codice_iva)" t-set="codiciIvaDummy"/>
                                    </t>
                                </t>
                                <t t-as="cIva" t-foreach="codiciIva">
                                    <t t-esc="cIva"/><br/>
                                </t> 
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-2" style="width:8.33%">
                                <t t-value="[]" t-set="imposta"/>
                                <t t-value="[]" t-set="codiciIva"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.codice_iva and (line.tax_ids.codice_iva not in codiciIva)">
                                        <t t-value="codiciIva.append(line.tax_ids.codice_iva)" t-set="codiciIvaDummy"/>
                                    </t>
                                </t>
                                <t t-as="cIva" t-foreach="codiciIva">
                                    <t t-value="0" t-set="imponibile"/>
                                    <t t-value="0" t-set="imposta_temp"/>
                                    <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                    <t t-as="line" t-foreach="lines">
                                        <t t-if="line.tax_ids.codice_iva == cIva">
                                            <t t-value="imponibile + line.price_subtotal" t-set="imponibile"/>
                                            <t t-value="imponibile*(line.tax_ids.amount / 100) " t-set="imposta_temp"/>
                                        </t>
                                    </t>
                                    <t t-value="imposta.append(imposta_temp)" t-set="impostaDummy"/>
                                    <t t-esc="imponibile" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/><br/>
                                </t>
                            </td>
                            <td class="p-1 align-middle text-center smaller-font col-3" style="width:8.33%">
                                <t t-as="impostaFor" t-foreach="imposta">
                                    <t t-esc="impostaFor" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/><br/>
                                </t>
                            </td>
                            
                            <td  class="p-1 align-middle text-center smaller-font col-6" style="width:16.66%">
                                <t t-set="totale_documento" t-value="o.amount_total+o.amount_sp"/>
                                <strong t-esc="totale_documento"  t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </td>
                            <td colspan="2" class="p-1 align-middle text-center smaller-font col-4" style="width:25%">
                                <t t-set="termini" t-value="o.invoice_payment_term_id"/>
                                <table class="table-borderless p-0 m-0 w-100">
                                <t t-set="importo_pagamento" t-value="o.amount_total"/>   
                                <t t-foreach="termini.line_ids" t-as="scadenza">
                                    <tr>
                                        
                                        <td class="p-0 pr-1 text-right"><t t-if="scadenza.value=='percent'"><span t-esc="scadenza.value_amount*o.amount_total/100"  t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/></t><t t-elif="scadenza.value=='fixed'"><span t-esc="scadenza.value_amount"  t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/></t><t t-else=""><t t-esc="importo_pagamento"  t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/></t></td>
                                       
                                        <t t-if="scadenza.day_of_the_month!=0">
                                            <td class="p-0 pr-1 text-left">Giorno <span t-field="scadenza.day_of_the_month"/> p.v.</td>
                                        </t>
                                         <t t-if="scadenza.day_of_the_month==0 and scadenza.days==0">
                                             <td class="p-0 pr-1 text-left"><span>pagamento immediato</span></td>
                                        </t>
                                        <t t-else="">
                                            <td class="p-0 pr-1 text-left"><span t-field="scadenza.days"/> <span t-field="scadenza.option"/></td>
                                        </t>
                                        
                                    </tr>
                                <t t-if="scadenza.value=='percent'">
                                    <t t-set="importo_pagamento" t-value="importo_pagamento-scadenza.value_amount*o.amount_total/100"/>
                                </t>
                                <t t-elif="scadenza.value=='fixed'">
                                    <t t-set="importo_pagamento" t-value="importo_pagamento-scadenza.value_amount"/>
                                </t>
                                <t t-else=""> <t t-set="importo_pagamento" t-value="0"/></t>
                                </t>
                                </table>   
                            </td>
                            <t t-if="o.amount_sp>0">
                                <td colspan="4" class="p-1 align-middle text-center smaller-font col-3" style="width:33.32%;height:30px">
                                <!--span t-field="o.amount_tax"/-->
                            </td>
                            </t>
                            <t t-else="">
                                <td colspan="3" class="p-1 align-middle text-center smaller-font col-3" style="width:33.32%;height:30px">
                                <!--span t-field="o.amount_tax"/-->
                            </td>
                            </t>
                        </tr>
                    </tbody>
                   
                   
                </table>
                
                <!-- TABELLA DDT -->

                <t t-if="o.delivery_note_count==0">

                    <table class="table table-bordered mt-1" id="ddt_table" style="page-break-inside: avoid;"> 
                        <thead>                      
                            <tr scope="row">
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>CAUSALE DEL TRASPORTO</span>
                                </th>
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>ASPETTO DEI BENI</span>
                                </th>
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>TRASPORTO A CURA DEL</span>
                                </th>
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>PORTO</span>
                                </th>
                                <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>COLLI</span>
                                </th>
                                <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>PESO LORDO</span>
                                </th>
                                <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>PESO NETTO</span>
                                </th>
                                <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span>VOLUME</span>
                                </th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr scope="row">
                                <!--td colspan="4" class="p-1 align-middle text-center smaller-font col-4" t-attf-style="width:33.33% {{ ';height:20px' if (o.id) else '' }}"-->
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-4" style="width:16.66%">
                                    <span t-field="o.transport_reason_id"/>
                                </td>
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-4" style="width:16.66%">
                                    <span t-field="o.goods_appearance_id"/>
                                </td>
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:16.66%">
                                    <span t-field="o.transport_method_id"/>
                                </td>
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span t-field="o.transport_condition_id"/>
                                </td>
                                <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.packages"/>
                                </td>
                                <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.gross_weight"/> <span t-field="o.gross_weight_uom_id"/>
                                </td>
                                <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.net_weight"/> <span t-field="o.net_weight_uom_id"/>
                                </td>
                                <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                    <span t-field="o.volume"/> <span t-field="o.volume_uom_id"/>
                                </td>
                                <!--td  class="p-1 align-middle text-center smaller-font col-2">
                                    <span>ABBUONO</span>
                                </td-->
                            </tr>
                        </tbody>
                       
                        <thead>
                           <tr scope="row">
                                <th colspan="4" class="p-1 align-middle text-center smaller-font col-4" style="width:33.32%">
                                    <span>DESCRIZIONE VETTORE</span>
                                </th>
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>DATA DEL RITIRO</span>
                                </th>
                                <th colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <span>DATA/ORA DEL TRASPORTO</span>
                                </th>
                               <th colspan="4" class="p-1 align-middle text-center smaller-font col-4" style="width:33.32%">
                                    <span>ANNOTAZIONI</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr scope="row">
                                <td colspan="4" class="p-1 align-middle text-center smaller-font col-7" style="width:33.32%">
                                    <span t-field="o.carrier_id.name"/>
                                </td>
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-3" style="width:16.66%">
                                    <span t-field="o.date"/>
                                </td>
                                <td colspan="2" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                                    <!--pan t-field="o.transport_datetime"  t-options='{"widget": "date"}'/-->
                                    <span t-field="o.transport_datetime"/>
                                </td>
                                <td colspan="4" class="p-1 align-middle text-center smaller-font col-4" style="width:33.32%">
                                    <span t-field="o.note"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </t>

                <table class="table table-bordered mt-1" style="page-break-inside: avoid;">
                            <thead>

                                <tr scope="row">
                                    <td colspan="31" class="p-1 align-middle text-center smaller-font col-1" style="background-color:white !important;border-top-width:medium !important">
                                        <div class="row">
                                            <div class="col-6"><strong>IBAN: BANCA SELLA IT 25 A 03268 16400 0524 8293 1250</strong><br/></div>
                                            <div class="col-6"><strong>IBAN: BANCO BPM IT 36 E 05034 81881 0000 00 1937 00</strong><br/></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12"><span>"Assolve gli obblighi di cui all’art. 62 comma 1 del DL 24 gennaio 2012 n. 1 convertito, con modificazioni dalla legge 24 marzo 2012 N. 27”.</span></div>
                                        </div> 
                                        <div class="row">
                                            <div class="col-12">LE CONDIZIONI GENERALI DI VENDITA E L'INFORMATIVA SULLA PRIVACY SONO DISPONIBILI SUL NOSTRO SITO www.planethoreca.it</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12"><strong>CONTRIBUTO AMBIENTALE CONAI ASSOLTO OVE DOVUTO</strong></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12"><strong>Documento privo di valenza fiscale ai sensi dell'art. 21 Dpr 633/72. L'originale è disponibile all'indirizzo telematico da Lei fornito oppure nella sua area riservata dell'Agenzia delle Entrate</strong></div>
                                        </div>
                                    </td>
                                </tr>
                                 <tr scope="row">
                                    <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%">
                                        <span>FIRMA CESSIONARIO</span>
                                    </th>
                                    <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%">
                                        <span>FIRMA DEL CONDUCENTE</span>
                                    </th>
                                    <th colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%">
                                        <span>FIRMA PER ACCETTAZIONE</span>
                                    </th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr scope="row">
                                    <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%;height:30px">

                                    </td>
                                    <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%;height:30px">

                                    </td>
                                    <td colspan="1" class="p-1 align-middle text-center smaller-font col-1" style="width:33.33%;height:30px">

                                    </td>

                                </tr>

                            </tbody>
                        </table>


            </div>
            
                           
                <!-- FOOTER -->
                <div t-attf-class="footer o_standard_footer o_company_#{o.company_id.id}_layout">
                    <div class="text-center">
                   
        
                       
        
                        <div t-if="report_type == 'pdf'" class="text-muted" style="font-size:80%;">
                            Pagina: <span class="page"/> / <span class="topage"/>
                        </div>
                    </div>
                </div>

           

            

            
        </t>
    </template>

    <template id="fattura_immediata_report_main_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="fattura_immediata.fattura_immediata_report_template" t-lang="o.partner_id.lang"/>
                <t t-set="print_with_payments" t-value="True"/>
            </t>
        </t>
    </template>
    
     <!--We need to create the following empty report template for the action report
            "action_account_original_vendor_bill" to work. The action is merging the
            original vendor bill(s) that were used to create the vendor bill(s) into one PDF. -->
    <template id="report_original_vendor_bill">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <div class="article"  t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')"></div>
            </t>
        </t>
    </template>

    <record id="fattura_immediata_report" model="ir.actions.report">
        <field name="name">Fattura immediata/differita</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field
            name="report_name"
        >fattura_immediata.fattura_immediata_report_main_template</field>
        <field
            name="report_file"
        >fattura_immediata.fattura_immediata_report_main_template</field>
        <field
            name="print_report_name"
        >'Fattura immediata/differita - %s' % object.display_name</field>
        <!--field name="binding_model_id" ref="account.report_invoice_with_payments" /-->
        <field name="binding_model_id" ref="account.model_account_move" />
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="fattura_immediata.paperformat_fattura"/>
    </record>

</odoo>
